(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{1102:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>g});var r=a(5155),t=a(2115),l=a(285),i=a(7550),o=a(2318),n=a(9869);let d=(0,a(9946).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var c=a(5060),m=a(4615),u=a(6821),p=a(983),x=a(3464),h=a(5695),f=a(638),j=a(4752),v=a.n(j);function b(){let e=(0,h.useRouter)(),s=(0,h.useParams)().id,a=(0,t.useRef)(),[p,j]=(0,t.useState)(!1),[b,g]=(0,t.useState)(!0),[y,N]=(0,t.useState)({name:"",email:"",password:"",password_confirmation:"",role:"user",active:!0,profile_photo:null,current_profile_photo:null});(0,t.useEffect)(()=>{(async()=>{try{g(!0);let a=sessionStorage.getItem("token");if(!a)return void e.push("/login");let r=await x.A.get((0,f.e9)("/users/".concat(s)),{headers:{Authorization:"Bearer ".concat(a),Accept:"application/json"}});if(r.data&&!0===r.data.status&&r.data.data){let e=r.data.data;N({name:e.name||"",email:e.email||"",password:"",password_confirmation:"",role:e.role||"user",active:1===e.active,profile_photo:null,current_profile_photo:e.profile_photo_url})}else throw Error("Utilisateur non trouv\xe9")}catch(s){var a,r;console.error("Erreur lors du chargement de l'utilisateur:",s),(null==(a=s.response)?void 0:a.status)===401||(null==(r=s.response)?void 0:r.status)===403?(sessionStorage.removeItem("token"),sessionStorage.removeItem("user"),e.push("/login")):(v().fire({icon:"error",title:"Erreur",text:"Erreur lors du chargement des donn\xe9es de l'utilisateur"}),e.push("/dashboard"))}finally{g(!1)}})()},[s,e]);let w=e=>{let{name:s,value:a,type:r,checked:t}=e.target;N(e=>({...e,[s]:"checkbox"===r?t:a}))},_=async a=>{a.preventDefault(),j(!0);try{let a=sessionStorage.getItem("token"),r=new FormData;for(let[e,s]of(r.append("name",y.name),r.append("email",y.email),r.append("role",y.role),r.append("active",y.active?"1":"0"),y.password&&(r.append("password",y.password),r.append("password_confirmation",y.password_confirmation)),y.profile_photo&&r.append("profile_photo",y.profile_photo),r.append("_method","PUT"),console.log("Donn\xe9es envoy\xe9es \xe0 l'API (FormData):"),r.entries()))console.log(e,s);let t=await x.A.post((0,f.e9)("/users/".concat(s)),r,{headers:{Authorization:"Bearer ".concat(a),"Content-Type":"multipart/form-data",Accept:"application/json"}});if(t.data.status)console.log("R\xe9ponse compl\xe8te de l'API:",JSON.stringify(t.data,null,2)),console.log("Donn\xe9es retourn\xe9es par l'API:",t.data.data),v().fire({icon:"success",title:"Succ\xe8s",text:t.data.message||"Utilisateur modifi\xe9 avec succ\xe8s"}),e.push("/dashboard");else throw console.log("R\xe9ponse API sans status true:",t.data),Error(t.data.message||"Erreur lors de la modification")}catch(s){var r,t,l,i;console.error("Erreur modification utilisateur:",s);let e="Erreur lors de la modification de l'utilisateur";(null==(t=s.response)||null==(r=t.data)?void 0:r.errors)?e=Object.values(s.response.data.errors).flat().join(", "):(null==(i=s.response)||null==(l=i.data)?void 0:l.message)&&(e=s.response.data.message),v().fire({icon:"error",title:"Erreur",text:e})}finally{j(!1)}};return b?(0,r.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,r.jsx)(c.A,{}),(0,r.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,r.jsx)(m.A,{}),(0,r.jsx)("main",{className:"flex-1 p-6 overflow-auto flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),(0,r.jsx)(u.A,{})]})]}):(0,r.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,r.jsx)(c.A,{}),(0,r.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,r.jsx)(m.A,{}),(0,r.jsx)("main",{className:"flex-1 p-6 overflow-auto",children:(0,r.jsxs)("div",{className:"mx-auto max-w-4xl px-2 sm:px-4 md:px-8 pt-8 pb-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Modifier l'Utilisateur"}),(0,r.jsx)("div",{className:"text-muted-foreground text-base mt-1",children:"Modifier les informations de l'utilisateur"})]}),(0,r.jsxs)(l.$,{variant:"outline",onClick:()=>e.push("/dashboard"),disabled:p,className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{size:16}),"Retour"]})]}),(0,r.jsxs)("form",{onSubmit:_,className:"bg-white border rounded-xl p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-3",children:"Photo de profil"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-20 h-20 rounded-full border flex items-center justify-center bg-gray-50 text-gray-400",children:y.profile_photo?(0,r.jsx)("img",{src:URL.createObjectURL(y.profile_photo),alt:"Preview",className:"w-20 h-20 rounded-full object-cover"}):y.current_profile_photo?(0,r.jsx)("img",{src:y.current_profile_photo,alt:"Current profile",className:"w-20 h-20 rounded-full object-cover"}):(0,r.jsx)(o.A,{size:32})}),(0,r.jsx)("input",{ref:a,type:"file",className:"hidden",accept:".jpeg,.png,.jpg,.gif",onChange:e=>{let s=e.target.files[0];if(s){if(s.size>2097152){v().fire({icon:"error",title:"Erreur",text:"La taille du fichier ne doit pas d\xe9passer 2MB"}),e.target.value="";return}if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(s.type)){v().fire({icon:"error",title:"Erreur",text:"Format de fichier non support\xe9. Utilisez JPEG, PNG ou GIF"}),e.target.value="";return}N(e=>({...e,profile_photo:s}))}}}),(0,r.jsxs)(l.$,{type:"button",variant:"outline",onClick:()=>a.current.click(),disabled:p,children:[(0,r.jsx)(n.A,{size:16,className:"mr-2"}),y.current_profile_photo?"Changer la photo":"Choisir une photo"]}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:".jpg/.png/.gif, 2Mo max."})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom complet *"}),(0,r.jsx)("input",{type:"text",name:"name",required:!0,className:"w-full border rounded px-3 py-2",placeholder:"Nom complet",value:y.name,onChange:w,disabled:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Email *"}),(0,r.jsx)("input",{type:"email",name:"email",required:!0,className:"w-full border rounded px-3 py-2",placeholder:"email@exemple.com",value:y.email,onChange:w,disabled:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nouveau mot de passe"}),(0,r.jsx)("input",{type:"password",name:"password",minLength:8,className:"w-full border rounded px-3 py-2",placeholder:"Laisser vide pour ne pas modifier",value:y.password,onChange:w,disabled:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Confirmer le nouveau mot de passe"}),(0,r.jsx)("input",{type:"password",name:"password_confirmation",className:"w-full border rounded px-3 py-2",placeholder:"Confirmer le nouveau mot de passe",value:y.password_confirmation,onChange:w,disabled:p})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"R\xf4le *"}),(0,r.jsxs)("select",{name:"role",required:!0,className:"w-full border rounded px-3 py-2",value:y.role,onChange:w,disabled:p,children:[(0,r.jsx)("option",{value:"user",children:"Utilisateur"}),(0,r.jsx)("option",{value:"admin",children:"Administrateur"})]})]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",name:"active",className:"accent-primary",checked:y.active,onChange:w,disabled:p}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Utilisateur actif"})]})})]}),(0,r.jsx)("div",{className:"flex justify-end mt-8 pt-6 border-t",children:(0,r.jsx)(l.$,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2",disabled:p,children:p?(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Modification..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{size:16,className:"mr-2"}),"Modifier l'Utilisateur"]})})})]})]})}),(0,r.jsx)(u.A,{})]})]})}function g(){return(0,r.jsx)(p.A,{children:(0,r.jsx)(b,{})})}},2318:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},5080:(e,s,a)=>{Promise.resolve().then(a.bind(a,1102))},9869:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[320,659,728,441,684,358],()=>s(5080)),_N_E=e.O()}]);